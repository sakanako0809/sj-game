<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç´™å¨ƒå¨ƒç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .draggable {
        cursor: move;
        user-select: none;
      }
      .item-slot {
        transition: all 0.3s ease;
      }
      .item-slot:hover {
        transform: scale(1.05);
      }
      .doll-area {
        background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
        position: relative;
        overflow: hidden;
      }
      .placed-item {
        position: absolute;
        cursor: move;
        border: 2px dashed transparent;
        transition: border 0.2s;
      }
      .placed-item:hover {
        border-color: #3b82f6;
      }
      .resize-handle {
        position: absolute;
        bottom: -8px;
        right: -8px;
        width: 24px;
        height: 24px;
        background: #3b82f6;
        border: 2px solid white;
        border-radius: 50%;
        cursor: nw-resize;
        display: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .placed-item:hover .resize-handle {
        display: block;
      }
      .delete-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 24px;
        height: 24px;
        background: #ef4444;
        border: 2px solid white;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        color: white;
        font-size: 14px;
        line-height: 20px;
        text-align: center;
        font-weight: bold;
      }
      .delete-btn:hover {
        background: #dc2626;
      }

      @media (max-width: 768px) {
        .resize-handle {
          width: 30px;
          height: 30px;
          bottom: -10px;
          right: -10px;
          display: block !important;
        }
        .delete-btn {
          width: 30px;
          height: 30px;
          top: -10px;
          right: -10px;
          font-size: 16px;
          line-height: 26px;
        }
      }

      .doll-card {
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .doll-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }
      .doll-card.selected {
        border: 3px solid #3b82f6;
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-pink-100 to-purple-100 min-h-screen">
    <!-- å¨ƒå¨ƒé¸æ“‡é é¢ -->
    <div id="dollSelectionPage" class="container mx-auto p-4 max-w-6xl">
      <div class="text-center mb-8">
        <h1 class="text-5xl font-bold text-purple-800 mb-4">ğŸ ç´™å¨ƒå¨ƒç³»çµ±</h1>
        <p class="text-xl text-gray-600 mb-2">é¸æ“‡ä½ å–œæ­¡çš„å¨ƒå¨ƒé–‹å§‹è£æ‰®ï¼</p>
        <p class="text-gray-500">é»æ“Šä¸‹æ–¹ä»»ä¸€å¨ƒå¨ƒé€²å…¥è£æ‰®æ¨¡å¼</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
        <div
          class="doll-card bg-white rounded-2xl shadow-lg p-6 text-center"
          onclick="selectDoll('ğŸ§â€â™€ï¸', 'å¥³å­©')"
        >
          <div class="text-8xl mb-4">ğŸ§â€â™€ï¸</div>
          <h3 class="text-lg font-bold text-gray-800">å¥³å­©</h3>
          <p class="text-sm text-gray-600">ç¶“å…¸å¥³æ€§å¨ƒå¨ƒ</p>
        </div>

        <div
          class="doll-card bg-white rounded-2xl shadow-lg p-6 text-center"
          onclick="selectDoll('ğŸ§â€â™‚ï¸', 'ç”·å­©')"
        >
          <div class="text-8xl mb-4">ğŸ§â€â™‚ï¸</div>
          <h3 class="text-lg font-bold text-gray-800">ç”·å­©</h3>
          <p class="text-sm text-gray-600">å¸¥æ°£ç”·æ€§å¨ƒå¨ƒ</p>
        </div>

        <div
          class="doll-card bg-white rounded-2xl shadow-lg p-6 text-center"
          onclick="selectDoll('ğŸ‘¶', 'å¯¶å¯¶')"
        >
          <div class="text-8xl mb-4">ğŸ‘¶</div>
          <h3 class="text-lg font-bold text-gray-800">å¯¶å¯¶</h3>
          <p class="text-sm text-gray-600">å¯æ„›å°å¯¶å¯¶</p>
        </div>

        <div
          class="doll-card bg-white rounded-2xl shadow-lg p-6 text-center"
          onclick="selectDoll('ğŸ‘µ', 'å¥¶å¥¶')"
        >
          <div class="text-8xl mb-4">ğŸ‘µ</div>
          <h3 class="text-lg font-bold text-gray-800">å¥¶å¥¶</h3>
          <p class="text-sm text-gray-600">æ…ˆç¥¥çš„å¥¶å¥¶</p>
        </div>
      </div>

      <div class="text-center">
        <div class="bg-white rounded-2xl shadow-lg p-6 inline-block">
          <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ® éŠæˆ²ç‰¹è‰²</h3>
          <div
            class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600"
          >
            <div class="flex items-center space-x-2">
              <span class="text-blue-500">ğŸ‘—</span>
              <span>è±å¯Œçš„æœè£é¸æ“‡</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-green-500">ğŸ“±</span>
              <span>æ”¯æ´æ‰‹æ©Ÿè§¸æ§</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-purple-500">ğŸ¨</span>
              <span>è‡ªç”±æ‹–æ‹½èª¿æ•´</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- éŠæˆ²ä¸»é é¢ -->
    <div
      id="gameMainPage"
      class="container mx-auto p-4 max-w-7xl"
      style="display: none"
    >
      <!-- æ¨™é¡Œ -->
      <div class="text-center mb-6">
        <h1 class="text-4xl font-bold text-purple-800 mb-2">ğŸ ç´™å¨ƒå¨ƒç³»çµ±</h1>
        <p class="text-gray-600">
          æ­£åœ¨è£æ‰®ï¼š<span
            id="selectedDollName"
            class="font-bold text-purple-600"
          ></span>
        </p>
        <div class="mt-2 flex justify-center items-center space-x-4">
          <span
            class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"
          >
            å·²æ”¾ç½®: <span id="itemCount">0</span>/10
          </span>
          <button
            onclick="backToDollSelection()"
            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
          >
            é‡é¸å¨ƒå¨ƒ
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- å·¦å´ç‰©ä»¶æ¬„ -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
              ğŸ‘— æœè£ç‰©ä»¶
            </h2>
            <div
              class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-4"
              id="itemsContainer"
            >
              <!-- ç‰©ä»¶æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <!-- å³å´å¨ƒå¨ƒå€åŸŸ -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2
              class="text-2xl font-bold text-gray-800 mb-4 flex items-center justify-between"
            >
              ğŸ­ å¨ƒå¨ƒè£æ‰®å€
              <button
                onclick="clearAll()"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              >
                æ¸…é™¤å…¨éƒ¨
              </button>
            </h2>
            <div
              class="doll-area rounded-xl h-96 md:h-[500px] relative border-4 border-dashed border-gray-300"
              id="dollArea"
            >
              <!-- å¨ƒå¨ƒæœ¬é«” -->
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-8xl md:text-9xl" id="selectedDollEmoji">
                  ğŸ§â€â™€ï¸
                </div>
              </div>
              <!-- æ”¾ç½®çš„ç‰©ä»¶æœƒå‡ºç¾åœ¨é€™è£¡ -->
            </div>
          </div>
        </div>
      </div>

      <!-- æ“ä½œèªªæ˜ -->
      <div class="mt-6 bg-white rounded-2xl shadow-lg p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ“± æ“ä½œèªªæ˜</h3>
        <div
          class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600"
        >
          <div class="flex items-center space-x-2">
            <span class="text-blue-500">ğŸ‘†</span>
            <span>é»æ“Šç‰©ä»¶æ‹–æ‹½åˆ°å¨ƒå¨ƒèº«ä¸Š</span>
          </div>
          <div class="flex items-center space-x-2">
            <span class="text-green-500">ğŸ”</span>
            <span>æ‹–æ‹½å³ä¸‹è§’åœ“é»èª¿æ•´å¤§å°</span>
          </div>
          <div class="flex items-center space-x-2">
            <span class="text-red-500">âŒ</span>
            <span>é»æ“Šç‰©ä»¶é¡¯ç¤ºåˆªé™¤æŒ‰éˆ•</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ç‰©ä»¶æ•¸æ“š
      const items = [
        { id: 1, emoji: "ğŸ‘•", name: "ä¸Šè¡£" },
        { id: 2, emoji: "ğŸ©", name: "å¸½å­" },
        { id: 3, emoji: "ğŸ‘ ", name: "é‹å­" },
      ];

      let placedItems = [];
      let draggedItem = null;
      let isDragging = false;
      let isResizing = false;
      let currentResizeItem = null;
      let selectedDoll = { emoji: "ğŸ§â€â™€ï¸", name: "å¥³å­©" };

      // é¸æ“‡å¨ƒå¨ƒ
      function selectDoll(emoji, name) {
        selectedDoll = { emoji, name };
        document.getElementById("selectedDollEmoji").textContent = emoji;
        document.getElementById("selectedDollName").textContent = name;

        // åˆ‡æ›é é¢
        document.getElementById("dollSelectionPage").style.display = "none";
        document.getElementById("gameMainPage").style.display = "block";

        // é‡ç½®éŠæˆ²ç‹€æ…‹
        placedItems = [];
        draggedItem = null;

        // åˆå§‹åŒ–éŠæˆ²åŠŸèƒ½
        initGame();
        renderPlacedItems();
        updateItemCount();
      }

      // è¿”å›å¨ƒå¨ƒé¸æ“‡é é¢
      function backToDollSelection() {
        if (
          placedItems.length > 0 &&
          !confirm("è¿”å›é¸æ“‡é é¢å°‡æ¸…é™¤æ‰€æœ‰è£æ‰®ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")
        ) {
          return;
        }

        document.getElementById("gameMainPage").style.display = "none";
        document.getElementById("dollSelectionPage").style.display = "block";

        // é‡ç½®éŠæˆ²ç‹€æ…‹
        placedItems = [];
        draggedItem = null;
        isDragging = false;
        isResizing = false;
        currentResizeItem = null;
        currentDragItem = null;
        document.body.style.cursor = "default";

        // æ¸…é™¤å¨ƒå¨ƒå€åŸŸçš„æ‰€æœ‰ç‰©ä»¶
        const dollArea = document.getElementById("dollArea");
        if (dollArea) {
          const existingItems = dollArea.querySelectorAll(".placed-item");
          existingItems.forEach((item) => item.remove());
        }

        updateItemCount();
      }

      // åˆå§‹åŒ–
      function init() {
        // åªåœ¨éŠæˆ²é é¢é¡¯ç¤ºæ™‚æ‰åˆå§‹åŒ–éŠæˆ²åŠŸèƒ½
        if (document.getElementById("gameMainPage").style.display !== "none") {
          renderItems();
          setupEventListeners();
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      function initGame() {
        renderItems();
        setupEventListeners();
      }

      // æ¸²æŸ“ç‰©ä»¶
      function renderItems() {
        const container = document.getElementById("itemsContainer");
        container.innerHTML = "";

        items.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className =
            "item-slot bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4 text-center cursor-pointer border-2 border-transparent hover:border-blue-300 transition-all";
          itemElement.innerHTML = `
                    <div class="text-4xl mb-2">${item.emoji}</div>
                    <div class="text-sm font-medium text-gray-700">${item.name}</div>
                `;
          itemElement.addEventListener("click", () => selectItem(item));
          container.appendChild(itemElement);
        });
      }

      // é¸æ“‡ç‰©ä»¶
      function selectItem(item) {
        if (placedItems.length >= 10) {
          alert("æœ€å¤šåªèƒ½æ”¾ç½®10å€‹ç‰©ä»¶ï¼");
          return;
        }

        draggedItem = { ...item, size: 60, x: 50, y: 50 };
        document.body.style.cursor = "move";
      }

      // è¨­ç½®äº‹ä»¶ç›£è½å™¨
      function setupEventListeners() {
        const dollArea = document.getElementById("dollArea");

        // é»æ“Šå¨ƒå¨ƒå€åŸŸæ”¾ç½®ç‰©ä»¶
        dollArea.addEventListener("click", (e) => {
          if (draggedItem && !isDragging && !isResizing) {
            e.preventDefault();
            const rect = dollArea.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;

            const newItem = {
              ...draggedItem,
              id: Date.now(),
              x: Math.max(5, Math.min(85, x)),
              y: Math.max(5, Math.min(85, y)),
            };

            placedItems.push(newItem);
            draggedItem = null;
            document.body.style.cursor = "default";
            renderPlacedItems();
            updateItemCount();
          } else if (!draggedItem && !isDragging && e.target === dollArea) {
            // é»æ“Šç©ºç™½è™•éš±è—æ‰€æœ‰åˆªé™¤æŒ‰éˆ•
            document
              .querySelectorAll(".placed-item .delete-btn")
              .forEach((btn) => {
                btn.style.display = "none";
              });
          }
        });

        // è§¸æ‘¸æ”¯æ´
        dollArea.addEventListener("touchend", (e) => {
          if (draggedItem && !isDragging) {
            e.preventDefault();
            const rect = dollArea.getBoundingClientRect();
            const touch = e.changedTouches[0];
            const x = ((touch.clientX - rect.left) / rect.width) * 100;
            const y = ((touch.clientY - rect.top) / rect.height) * 100;

            const newItem = {
              ...draggedItem,
              id: Date.now(),
              x: Math.max(5, Math.min(85, x)),
              y: Math.max(5, Math.min(85, y)),
            };

            placedItems.push(newItem);
            draggedItem = null;
            document.body.style.cursor = "default";
            renderPlacedItems();
            updateItemCount();
          } else if (!draggedItem && !isDragging) {
            // é»æ“Šç©ºç™½è™•éš±è—æ‰€æœ‰åˆªé™¤æŒ‰éˆ•
            document
              .querySelectorAll(".placed-item .delete-btn")
              .forEach((btn) => {
                btn.style.display = "none";
              });
          }
        });
      }

      // æ¸²æŸ“å·²æ”¾ç½®çš„ç‰©ä»¶
      function renderPlacedItems() {
        const dollArea = document.getElementById("dollArea");
        const existingItems = dollArea.querySelectorAll(".placed-item");
        existingItems.forEach((item) => item.remove());

        placedItems.forEach((item, index) => {
          const itemElement = document.createElement("div");
          itemElement.className = "placed-item";
          itemElement.style.left = `${item.x}%`;
          itemElement.style.top = `${item.y}%`;
          itemElement.style.fontSize = `${item.size}px`;
          itemElement.dataset.itemId = item.id;
          itemElement.innerHTML = `
                    ${item.emoji}
                    <div class="resize-handle"></div>
                    <div class="delete-btn">Ã—</div>
                `;

          // æ‹–æ‹½åŠŸèƒ½
          itemElement.addEventListener("mousedown", (e) => {
            if (e.target.classList.contains("resize-handle")) return;
            e.preventDefault();

            isDragging = true;
            currentDragItem = item;

            const rect = dollArea.getBoundingClientRect();
            startX = e.clientX;
            startY = e.clientY;
            startItemX = item.x;
            startItemY = item.y;

            itemElement.style.zIndex = "1000";
            document.body.style.cursor = "move";
          });

          // è§¸æ‘¸æ‹–æ‹½
          itemElement.addEventListener("touchstart", (e) => {
            if (
              e.target.classList.contains("resize-handle") ||
              e.target.classList.contains("delete-btn")
            )
              return;
            e.preventDefault();

            isDragging = true;
            currentDragItem = item;

            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            startItemX = item.x;
            startItemY = item.y;

            itemElement.style.zIndex = "1000";
          });

          // é»æ“Šé¡¯ç¤º/éš±è—åˆªé™¤æŒ‰éˆ•
          itemElement.addEventListener("click", (e) => {
            if (
              e.target.classList.contains("resize-handle") ||
              e.target.classList.contains("delete-btn")
            )
              return;
            e.preventDefault();
            e.stopPropagation();

            // éš±è—å…¶ä»–ç‰©ä»¶çš„åˆªé™¤æŒ‰éˆ•
            document
              .querySelectorAll(".placed-item .delete-btn")
              .forEach((btn) => {
                if (btn.parentElement !== itemElement) {
                  btn.style.display = "none";
                }
              });

            // åˆ‡æ›ç•¶å‰ç‰©ä»¶çš„åˆªé™¤æŒ‰éˆ•
            const deleteBtn = itemElement.querySelector(".delete-btn");
            deleteBtn.style.display =
              deleteBtn.style.display === "block" ? "none" : "block";
          });

          // è§¸æ‘¸é»æ“Šé¡¯ç¤º/éš±è—åˆªé™¤æŒ‰éˆ•
          itemElement.addEventListener("touchend", (e) => {
            if (
              e.target.classList.contains("resize-handle") ||
              e.target.classList.contains("delete-btn")
            )
              return;
            if (isDragging) return; // å¦‚æœæ˜¯æ‹–æ‹½æ“ä½œå°±ä¸è™•ç†é»æ“Š

            e.preventDefault();
            e.stopPropagation();

            // éš±è—å…¶ä»–ç‰©ä»¶çš„åˆªé™¤æŒ‰éˆ•
            document
              .querySelectorAll(".placed-item .delete-btn")
              .forEach((btn) => {
                if (btn.parentElement !== itemElement) {
                  btn.style.display = "none";
                }
              });

            // åˆ‡æ›ç•¶å‰ç‰©ä»¶çš„åˆªé™¤æŒ‰éˆ•
            const deleteBtn = itemElement.querySelector(".delete-btn");
            deleteBtn.style.display =
              deleteBtn.style.display === "block" ? "none" : "block";
          });

          // èª¿æ•´å¤§å°
          const resizeHandle = itemElement.querySelector(".resize-handle");
          resizeHandle.addEventListener("mousedown", (e) => {
            e.stopPropagation();
            e.preventDefault();
            isResizing = true;
            currentResizeItem = item;
            document.body.style.cursor = "nw-resize";
          });

          // è§¸æ‘¸èª¿æ•´å¤§å°
          resizeHandle.addEventListener("touchstart", (e) => {
            e.stopPropagation();
            e.preventDefault();
            isResizing = true;
            currentResizeItem = item;

            const touch = e.touches[0];
            resizeStartX = touch.clientX;
            resizeStartY = touch.clientY;
            resizeStartSize = item.size;
          });

          // åˆªé™¤æŒ‰éˆ•åŠŸèƒ½
          const deleteBtn = itemElement.querySelector(".delete-btn");
          deleteBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            e.preventDefault();
            placedItems = placedItems.filter((p) => p.id !== item.id);
            renderPlacedItems();
            updateItemCount();
          });

          // åˆªé™¤æŒ‰éˆ•è§¸æ‘¸åŠŸèƒ½
          deleteBtn.addEventListener("touchend", (e) => {
            e.stopPropagation();
            e.preventDefault();
            placedItems = placedItems.filter((p) => p.id !== item.id);
            renderPlacedItems();
            updateItemCount();
          });

          dollArea.appendChild(itemElement);
        });
      }

      // å…¨åŸŸè®Šæ•¸ç”¨æ–¼æ‹–æ‹½
      let currentDragItem = null;
      let startX, startY, startItemX, startItemY;
      let resizeStartX, resizeStartY, resizeStartSize;

      // å…¨åŸŸæ»‘é¼ ç§»å‹•äº‹ä»¶
      document.addEventListener("mousemove", (e) => {
        if (isDragging && !isResizing && currentDragItem) {
          const dollArea = document.getElementById("dollArea");
          const rect = dollArea.getBoundingClientRect();
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;

          const deltaXPercent = (deltaX / rect.width) * 100;
          const deltaYPercent = (deltaY / rect.height) * 100;

          const newX = Math.max(0, Math.min(90, startItemX + deltaXPercent));
          const newY = Math.max(0, Math.min(90, startItemY + deltaYPercent));

          currentDragItem.x = newX;
          currentDragItem.y = newY;

          // å³æ™‚æ›´æ–°ä½ç½®
          const itemElement = document.querySelector(
            `[data-item-id="${currentDragItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.left = `${newX}%`;
            itemElement.style.top = `${newY}%`;
          }
        } else if (isResizing && currentResizeItem) {
          const newSize = Math.max(
            20,
            Math.min(
              120,
              currentResizeItem.size + (e.movementX + e.movementY) / 2
            )
          );
          currentResizeItem.size = newSize;
          const itemElement = document.querySelector(
            `[data-item-id="${currentResizeItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.fontSize = `${newSize}px`;
          }
        }
      });

      // è§¸æ‘¸ç§»å‹•äº‹ä»¶
      document.addEventListener("touchmove", (e) => {
        if (isDragging && !isResizing && currentDragItem) {
          e.preventDefault();
          const dollArea = document.getElementById("dollArea");
          const rect = dollArea.getBoundingClientRect();
          const touch = e.touches[0];
          const deltaX = touch.clientX - startX;
          const deltaY = touch.clientY - startY;

          const deltaXPercent = (deltaX / rect.width) * 100;
          const deltaYPercent = (deltaY / rect.height) * 100;

          const newX = Math.max(0, Math.min(90, startItemX + deltaXPercent));
          const newY = Math.max(0, Math.min(90, startItemY + deltaYPercent));

          currentDragItem.x = newX;
          currentDragItem.y = newY;

          // å³æ™‚æ›´æ–°ä½ç½®
          const itemElement = document.querySelector(
            `[data-item-id="${currentDragItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.left = `${newX}%`;
            itemElement.style.top = `${newY}%`;
          }
        } else if (isResizing && currentResizeItem) {
          e.preventDefault();
          const touch = e.touches[0];
          const deltaX = touch.clientX - resizeStartX;
          const deltaY = touch.clientY - resizeStartY;
          const delta = (deltaX + deltaY) / 2;

          const newSize = Math.max(20, Math.min(120, resizeStartSize + delta));
          currentResizeItem.size = newSize;

          const itemElement = document.querySelector(
            `[data-item-id="${currentResizeItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.fontSize = `${newSize}px`;
          }
        }
      });

      // åœæ­¢æ‹–æ‹½
      document.addEventListener("mouseup", () => {
        if (currentDragItem) {
          const itemElement = document.querySelector(
            `[data-item-id="${currentDragItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.zIndex = "";
          }
        }
        isDragging = false;
        isResizing = false;
        currentDragItem = null;
        currentResizeItem = null;
        document.body.style.cursor = "default";
      });

      document.addEventListener("touchend", () => {
        if (currentDragItem) {
          const itemElement = document.querySelector(
            `[data-item-id="${currentDragItem.id}"]`
          );
          if (itemElement) {
            itemElement.style.zIndex = "";
          }
        }
        isDragging = false;
        isResizing = false;
        currentDragItem = null;
        currentResizeItem = null;
      });

      // æ›´æ–°ç‰©ä»¶è¨ˆæ•¸
      function updateItemCount() {
        document.getElementById("itemCount").textContent = placedItems.length;
      }

      // æ¸…é™¤æ‰€æœ‰ç‰©ä»¶
      function clearAll() {
        if (placedItems.length === 0) {
          alert("æ²’æœ‰ç‰©ä»¶å¯ä»¥æ¸…é™¤ï¼");
          return;
        }

        if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç‰©ä»¶å—ï¼Ÿ")) {
          // é‡ç½®æ‰€æœ‰ç‹€æ…‹
          placedItems = [];
          draggedItem = null;
          isDragging = false;
          isResizing = false;
          currentResizeItem = null;
          currentDragItem = null;
          document.body.style.cursor = "default";

          // é‡æ–°æ¸²æŸ“ï¼ˆé€™æœƒæ¸…é™¤æ‰€æœ‰ç‰©ä»¶ï¼‰
          renderPlacedItems();
          updateItemCount();
        }
      }

      // å–æ¶ˆé¸æ“‡
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && draggedItem) {
          draggedItem = null;
          document.body.style.cursor = "default";
        }
      });

      // å•Ÿå‹•æ‡‰ç”¨
      init();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'97a3e523c3a1f1dc',t:'MTc1NzA1NjEwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
