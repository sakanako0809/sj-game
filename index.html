<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>紙娃娃系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .draggable {
        cursor: move;
        user-select: none;
      }
      .item-slot {
        transition: all 0.3s ease;
      }
      .item-slot:hover {
        transform: scale(1.05);
      }
      .doll-area {
        background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
        position: relative;
        overflow: hidden;
      }
      .placed-item {
        position: absolute;
        cursor: move;
        border: 2px dashed transparent;
        transition: border 0.2s;
      }
      .placed-item:hover {
        border-color: #3b82f6;
      }
      .resize-handle {
        position: absolute;
        bottom: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        background: #3b82f6;
        border-radius: 50%;
        cursor: nw-resize;
        display: none;
      }
      .placed-item:hover .resize-handle {
        display: block;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-pink-100 to-purple-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
      <!-- 標題 -->
      <div class="text-center mb-6">
        <h1 class="text-4xl font-bold text-purple-800 mb-2">🎎 紙娃娃系統</h1>
        <p class="text-gray-600">拖拽物件到娃娃身上，點擊調整大小！</p>
        <div class="mt-2">
          <span
            class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"
          >
            已放置: <span id="itemCount">0</span>/10
          </span>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 左側物件欄 -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
              👗 服裝物件
            </h2>
            <div
              class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-4"
              id="itemsContainer"
            >
              <!-- 物件會動態生成 -->
            </div>
          </div>
        </div>

        <!-- 右側娃娃區域 -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2
              class="text-2xl font-bold text-gray-800 mb-4 flex items-center justify-between"
            >
              🎭 娃娃裝扮區
              <button
                onclick="clearAll()"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              >
                清除全部
              </button>
            </h2>
            <div
              class="doll-area rounded-xl h-96 md:h-[500px] relative border-4 border-dashed border-gray-300"
              id="dollArea"
            >
              <!-- 娃娃本體 -->
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-8xl md:text-9xl">🧍‍♀️</div>
              </div>
              <!-- 放置的物件會出現在這裡 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 操作說明 -->
      <div class="mt-6 bg-white rounded-2xl shadow-lg p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-3">📱 操作說明</h3>
        <div
          class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600"
        >
          <div class="flex items-center space-x-2">
            <span class="text-blue-500">👆</span>
            <span>點擊物件拖拽到娃娃身上</span>
          </div>
          <div class="flex items-center space-x-2">
            <span class="text-green-500">🔍</span>
            <span>拖拽右下角圓點調整大小</span>
          </div>
          <div class="flex items-center space-x-2">
            <span class="text-red-500">❌</span>
            <span>雙擊物件可以移除</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 物件數據
      const items = [
        { id: 1, emoji: "👕", name: "上衣", category: "top" },
        { id: 2, emoji: "👖", name: "褲子", category: "bottom" },
        { id: 3, emoji: "👗", name: "洋裝", category: "dress" },
        { id: 4, emoji: "👠", name: "高跟鞋", category: "shoes" },
        { id: 5, emoji: "👟", name: "運動鞋", category: "shoes" },
        { id: 6, emoji: "🎩", name: "帽子", category: "hat" },
        { id: 7, emoji: "👑", name: "皇冠", category: "hat" },
        { id: 8, emoji: "🕶️", name: "太陽眼鏡", category: "accessory" },
        { id: 9, emoji: "👜", name: "手提包", category: "accessory" },
        { id: 10, emoji: "⌚", name: "手錶", category: "accessory" },
        { id: 11, emoji: "🧣", name: "圍巾", category: "accessory" },
        { id: 12, emoji: "🧤", name: "手套", category: "accessory" },
      ];

      let placedItems = [];
      let draggedItem = null;
      let isDragging = false;
      let isResizing = false;
      let currentResizeItem = null;

      // 初始化
      function init() {
        renderItems();
        setupEventListeners();
      }

      // 渲染物件
      function renderItems() {
        const container = document.getElementById("itemsContainer");
        container.innerHTML = "";

        items.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className =
            "item-slot bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4 text-center cursor-pointer border-2 border-transparent hover:border-blue-300 transition-all";
          itemElement.innerHTML = `
                    <div class="text-4xl mb-2">${item.emoji}</div>
                    <div class="text-sm font-medium text-gray-700">${item.name}</div>
                `;
          itemElement.addEventListener("click", () => selectItem(item));
          container.appendChild(itemElement);
        });
      }

      // 選擇物件
      function selectItem(item) {
        if (placedItems.length >= 10) {
          alert("最多只能放置10個物件！");
          return;
        }

        draggedItem = { ...item, size: 60, x: 50, y: 50 };
        document.body.style.cursor = "move";
      }

      // 設置事件監聽器
      function setupEventListeners() {
        const dollArea = document.getElementById("dollArea");

        // 點擊娃娃區域放置物件
        dollArea.addEventListener("click", (e) => {
          if (draggedItem && !isDragging && !isResizing) {
            const rect = dollArea.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;

            draggedItem.x = Math.max(5, Math.min(85, x));
            draggedItem.y = Math.max(5, Math.min(85, y));

            placedItems.push({ ...draggedItem, id: Date.now() });
            draggedItem = null;
            document.body.style.cursor = "default";
            renderPlacedItems();
            updateItemCount();
          }
        });

        // 觸摸支援
        dollArea.addEventListener("touchend", (e) => {
          if (draggedItem && !isDragging) {
            e.preventDefault();
            const rect = dollArea.getBoundingClientRect();
            const touch = e.changedTouches[0];
            const x = ((touch.clientX - rect.left) / rect.width) * 100;
            const y = ((touch.clientY - rect.top) / rect.height) * 100;

            draggedItem.x = Math.max(5, Math.min(85, x));
            draggedItem.y = Math.max(5, Math.min(85, y));

            placedItems.push({ ...draggedItem, id: Date.now() });
            draggedItem = null;
            document.body.style.cursor = "default";
            renderPlacedItems();
            updateItemCount();
          }
        });
      }

      // 渲染已放置的物件
      function renderPlacedItems() {
        const dollArea = document.getElementById("dollArea");
        const existingItems = dollArea.querySelectorAll(".placed-item");
        existingItems.forEach((item) => item.remove());

        placedItems.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className = "placed-item";
          itemElement.style.left = `${item.x}%`;
          itemElement.style.top = `${item.y}%`;
          itemElement.style.fontSize = `${item.size}px`;
          itemElement.innerHTML = `
                    ${item.emoji}
                    <div class="resize-handle"></div>
                `;

          // 拖拽功能
          let startX, startY, startLeft, startTop;

          itemElement.addEventListener("mousedown", (e) => {
            if (e.target.classList.contains("resize-handle")) return;
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            const rect = dollArea.getBoundingClientRect();
            startLeft = (parseFloat(item.x) / 100) * rect.width;
            startTop = (parseFloat(item.y) / 100) * rect.height;
          });

          // 觸摸拖拽
          itemElement.addEventListener("touchstart", (e) => {
            if (e.target.classList.contains("resize-handle")) return;
            isDragging = true;
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            const rect = dollArea.getBoundingClientRect();
            startLeft = (parseFloat(item.x) / 100) * rect.width;
            startTop = (parseFloat(item.y) / 100) * rect.height;
          });

          // 雙擊移除
          itemElement.addEventListener("dblclick", () => {
            placedItems = placedItems.filter((p) => p.id !== item.id);
            renderPlacedItems();
            updateItemCount();
          });

          // 調整大小
          const resizeHandle = itemElement.querySelector(".resize-handle");
          resizeHandle.addEventListener("mousedown", (e) => {
            e.stopPropagation();
            isResizing = true;
            currentResizeItem = item;
          });

          dollArea.appendChild(itemElement);
        });
      }

      // 全域滑鼠移動事件
      document.addEventListener("mousemove", (e) => {
        if (isDragging && !isResizing) {
          const dollArea = document.getElementById("dollArea");
          const rect = dollArea.getBoundingClientRect();
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;

          const newLeft = startLeft + deltaX;
          const newTop = startTop + deltaY;

          const newX = Math.max(0, Math.min(90, (newLeft / rect.width) * 100));
          const newY = Math.max(0, Math.min(90, (newTop / rect.height) * 100));

          // 更新物件位置
          const movingItem = placedItems.find((item) => {
            const itemElement = document.elementFromPoint(e.clientX, e.clientY);
            return itemElement && itemElement.classList.contains("placed-item");
          });

          if (movingItem) {
            movingItem.x = newX;
            movingItem.y = newY;
            renderPlacedItems();
          }
        } else if (isResizing && currentResizeItem) {
          const newSize = Math.max(
            20,
            Math.min(
              120,
              currentResizeItem.size + (e.movementX + e.movementY) / 2
            )
          );
          currentResizeItem.size = newSize;
          renderPlacedItems();
        }
      });

      // 觸摸移動事件
      document.addEventListener("touchmove", (e) => {
        if (isDragging && !isResizing) {
          e.preventDefault();
          const dollArea = document.getElementById("dollArea");
          const rect = dollArea.getBoundingClientRect();
          const touch = e.touches[0];
          const deltaX = touch.clientX - startX;
          const deltaY = touch.clientY - startY;

          const newLeft = startLeft + deltaX;
          const newTop = startTop + deltaY;

          const newX = Math.max(0, Math.min(90, (newLeft / rect.width) * 100));
          const newY = Math.max(0, Math.min(90, (newTop / rect.height) * 100));

          // 找到正在移動的物件並更新位置
          placedItems.forEach((item) => {
            if (Math.abs(item.x - newX) < 5 && Math.abs(item.y - newY) < 5) {
              item.x = newX;
              item.y = newY;
            }
          });
          renderPlacedItems();
        }
      });

      // 停止拖拽
      document.addEventListener("mouseup", () => {
        isDragging = false;
        isResizing = false;
        currentResizeItem = null;
      });

      document.addEventListener("touchend", () => {
        isDragging = false;
        isResizing = false;
        currentResizeItem = null;
      });

      // 更新物件計數
      function updateItemCount() {
        document.getElementById("itemCount").textContent = placedItems.length;
      }

      // 清除所有物件
      function clearAll() {
        if (placedItems.length > 0 && confirm("確定要清除所有物件嗎？")) {
          placedItems = [];
          renderPlacedItems();
          updateItemCount();
        }
      }

      // 取消選擇
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && draggedItem) {
          draggedItem = null;
          document.body.style.cursor = "default";
        }
      });

      // 啟動應用
      init();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'97a3ba1d25a8f1dc',t:'MTc1NzA1NDM0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
